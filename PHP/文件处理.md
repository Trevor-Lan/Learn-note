文件类型

```php
is_dir($file)
```



文件是否存在

```php
file_exists($file)
```



新建目录

```php
mkdir($file)
```



新建文件

```php
touch($file)
```



复制

```php
copy($originalFile,$newFile)
```



剪切

```php
rename($oldName, $newName)
```



重命名

```php
rename($oldName, $newName)
```



删除

```php
 rmdir($dir);
```

```php
 unlink($file);
```



读取

```php
file_get_contents($file);
```



写入

```php
file_put_contents($file, $content);
```



搜索

```php
/**
* 关键词搜索路径下的文件
*
* @param string $path 文件路径
* @param string $keyWord 关键词
* @return array
*/
protected function getFileInDir($path, $keyWord)
{
    $data = scandir($path);
    foreach ($data as $k => $v) {
        if (strpos($v, $keyWord) === false) {
            unset($data[$k]);
        }
    }
    return $data;
}
```



上传

```php
move_uploaded_file($_FILES['file']['tmp_name'], $file);
```



下载

```php
/**
 * 分片下载文件
 *
 * @param string $file 文件路径
 */
public static function file($file)
{
    // 分片下载默认为10M/片
    $chunk_size = 10 * (1024 * 1024);
    // 判断要下载的文件是否存在
    if (file_exists($file)) {
        // 设置下载进程不自动过期
        set_time_limit(0);
        $size = filesize($file);
        header('Content-Type: application/octet-stream');
        header('Content-Transfer-Encoding: binary');
        header('Content-Length: ' . $size);
        header('Content-Disposition: attachment;filename="' . basename($file) . '"');
        if ($size > $chunk_size) {
            $handle = fopen($file, 'rb');
            // 分片下载
            while (!feof($handle)) {
                print(@fread($handle, $chunk_size));
                ob_flush();
                flush();
            }
            fclose($handle);
        } else {
            readfile($file);
        }
        exit;
    }
}
```



压缩/解解压

```php
/**
 * 文件夹压缩与解压工具
 *
 * Class Zip
 * @package app\common\utils
 */
class Zip
{
    /**
     * Add files and sub-directories in a folder to zip file.
     * @param string $folder
     * @param ZipArchive $zipFile
     * @param int $exclusiveLength Number of text to be exclusived from the file path.
     */
    private static function folderToZip($folder, &$zipFile, $exclusiveLength) {
        $handle = opendir($folder);
        while (false !== $f = readdir($handle)) {
            if ($f != '.' && $f != '..') {
                $filePath = "$folder/$f";
                // Remove prefix from file path before add to zip.
                $localPath = substr($filePath, $exclusiveLength);
                if (is_file($filePath)) {
                    $zipFile->addFile($filePath, $localPath);
                } elseif (is_dir($filePath)) {
                    // Add sub-directory.
                    $zipFile->addEmptyDir($localPath);
                    self::folderToZip($filePath, $zipFile, $exclusiveLength);
                }
            }
        }
        closedir($handle);
    }

    /**
     * Zip a folder (include itself).
     * Usage:
     *   HZip::zipDir('/path/to/sourceDir', '/path/to/out.zip');
     *
     * @param string $sourcePath Path of directory to be zip.
     * @param string $outZipPath Path of output zip file.
     */
    public static function zipDir($sourcePath, $outZipPath)
    {
        $pathInfo = pathInfo($sourcePath);
        $parentPath = $pathInfo['dirname'];
        $dirName = $pathInfo['basename'];

        $z = new \ZipArchive();
        $z->open($outZipPath, \ZIPARCHIVE::CREATE);
        $z->addEmptyDir($dirName);
        self::folderToZip($sourcePath, $z, strlen("$parentPath/"));
        $z->close();
    }

    /**
     * 解压文件
     *
     * @param string $zipFile 压缩包
     * @param string $toDir 解压后的路径
     * @return string
     */
    public static function unzip($zipFile,$toDir){
        $zip = new \ZipArchive();
        if ($zip->open($zipFile) === true) {
            $rf = zip_open($zipFile);
            $i = 0;
            while ($fr = zip_read($rf)) {
                $fileInfo = $zip->statIndex($i, \ZipArchive::FL_ENC_RAW);
                //转码 否则中文会出现乱码
                $encode = mb_detect_encoding($fileInfo['name'], ['ASCII', 'UTF-8', 'GB2312', 'GBK', 'BIG5']);
                if ($encode === false) {
                    return '未识别到该字符编码';
                }
                $fileName = mb_convert_encoding($fileInfo['name'], 'UTF-8', $encode);
                //如果是目录
                if ($fileInfo['crc'] === 0) {
                    //新建目录
                    $dir = $toDir . $fileName;
                    if(!file_exists($dir) && ! is_dir($dir) && ! mkdir($dir) && ! is_dir($dir)){
                        throw new AdminException(Msg::FAIL[1], Msg::FAIL[0]);
                    }
                } else {
                    //读取文件内容并写入
                    $content = zip_entry_read($fr, zip_entry_filesize($fr));
                    if(!file_exists($toDir) && ! is_dir($toDir) && ! mkdir($toDir) && ! is_dir($toDir)){
                        throw new AdminException(Msg::FAIL[1], Msg::FAIL[0]);
                    }
                    file_put_contents($toDir . $fileName, $content);
                }
                $i++;
            }
        }
        $zip->close();
    }
}
```

